import React, { useState } from 'react';
import { Sparkles, Music, Loader2, Play } from 'lucide-react';

// --- Component Helpers (‡∏ï‡πâ‡∏≠‡∏á‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏à‡∏≤‡∏Å ScriptGenerator.jsx) ---
// Note: AccentButton ‡πÅ‡∏•‡∏∞ FormInput ‡∏ñ‡∏π‡∏Å‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏õ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô ScriptGenerator.jsx ‡πÅ‡∏•‡πâ‡∏ß
// ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ß‡πà‡∏≤‡∏°‡∏±‡∏ô‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô Props ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô Global Component

const AccentButton = ({ children, onClick, disabled, className = '', icon: Icon, type = 'button' }) => (
    <button
        type={type}
        onClick={onClick}
        disabled={disabled}
        className={`flex items-center justify-center gap-2 px-4 py-2 text-sm font-bold rounded-xl transition-all shadow-md active:scale-[0.98] whitespace-nowrap ${
            disabled
                ? 'bg-gray-300 text-gray-500 cursor-not-allowed'
                : 'bg-orange-600 text-white hover:bg-orange-700 shadow-orange-300/50'
        } ${className}`}
    >
        {Icon && <Icon size={16} />}
        {children}
    </button>
);

const FormInput = ({ label, value, onChange, placeholder, type = 'text', step, min, max, icon: Icon, className = '' }) => (
    <div className={`flex flex-col space-y-2 ${className}`}>
        <label className="text-sm font-semibold text-gray-700 flex items-center gap-2">
            {Icon && <Icon size={16} className="text-orange-500" />}
            {label}
        </label>
        <input
            type={type}
            value={value}
            onChange={onChange}
            placeholder={placeholder}
            step={step}
            min={min}
            max={max}
            className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all text-gray-900 placeholder-gray-400 bg-white"
        />
    </div>
);

// -------------------------------------------------------------

const MusicGenerator = ({ userCredit, consumeCredit, user }) => {
    const [topic, setTopic] = useState('');
    const [genre, setGenre] = useState('');
    const [isLoading, setIsLoading] = useState(false);
    const [musicResult, setMusicResult] = useState(null);
    const MUSIC_COST = 0; // üéØ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô 0 ‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï (Unlimited) ‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à
    
    // ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á Genres ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏¥‡∏¢‡∏°
    const popularGenres = [
        "Pop", "Rock", "Hip-Hop", "EDM", "Jazz", "Acoustic", 
        "Ambient (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Meditation/‡∏ò‡∏£‡∏£‡∏°‡∏∞)", "Cinematic (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Trailer)", "Lofi"
    ];

    const handleGenerateMusic = async () => {
        if (!topic.trim() || !genre.trim()) {
            alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏õ‡πâ‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡∏ß‡πÄ‡∏û‡∏•‡∏á‡∏Ñ‡∏£‡∏±‡∏ö");
            return;
        }

        // --- 1. Check Credit (‡∏ñ‡∏∂‡∏á‡πÅ‡∏°‡πâ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô 0 ‡πÅ‡∏ï‡πà‡∏Å‡πá‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ Logic ‡∏ô‡∏µ‡πâ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï) ---
        if (userCredit < MUSIC_COST) {
            alert(`‚ö†Ô∏è ‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡πÑ‡∏°‡πà‡∏û‡∏≠! ‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ ${userCredit} ‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï ‡πÅ‡∏ï‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ ${MUSIC_COST} ‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï`); 
            return;
        }

        // --- 2. Start Generation (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏´‡∏±‡∏Å‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡πÄ‡∏û‡∏£‡∏≤‡∏∞ MUSIC_COST = 0) ---
        setIsLoading(true);
        setMusicResult(null);

        try {
            // üí° ‡πÇ‡∏Ñ‡πâ‡∏î‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å Suno API, Udio API, ‡∏´‡∏£‡∏∑‡∏≠ Google Music API ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
            // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏£‡∏≤‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
            await new Promise(resolve => setTimeout(resolve, 3000)); 

            // ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
            setMusicResult({
                title: `${genre} Beat: ${topic}`,
                duration: "1:30",
                url: "https://placehold.co/400x100/34D399/FFFFFF?text=Generated+Music+File",
                lyrics: "Sample lyrics generated by AI: Rhythm is calling, the future is bright, viral content all day and night."
            });
            
        } catch (error) {
            console.error("Music Generation Error:", error);
            alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏û‡∏•‡∏á: " + error.message);
        } finally {
            setIsLoading(false);
        }
    };

    return (
        <div className="bg-white p-5 md:p-8 rounded-xl shadow-lg border border-gray-200">
            <h2 className="text-2xl font-extrabold text-gray-900 flex items-center gap-2 mb-6">
                <Music size={24} className="text-blue-600"/> 
                ‡πÇ‡∏°‡∏î‡∏π‡∏• 2: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏û‡∏•‡∏á/‡∏ö‡∏µ‡∏ó‡∏ï‡∏¥‡∏î‡πÑ‡∏ß‡∏£‡∏±‡∏• (Unlimited!)
            </h2>

            <div className="space-y-6 pt-3">
                <FormInput
                    label="‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÄ‡∏û‡∏•‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ (‡∏¢‡∏¥‡πà‡∏á‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î ‡∏¢‡∏¥‡πà‡∏á‡∏î‡∏µ)"
                    value={topic}
                    onChange={(e) => setTopic(e.target.value)}
                    placeholder="‡πÄ‡∏ä‡πà‡∏ô: ‡πÄ‡∏û‡∏•‡∏á‡∏ö‡∏µ‡∏ó‡∏™‡∏ô‡∏∏‡∏Å‡πÜ ‡∏™‡πÑ‡∏ï‡∏•‡πå Lofi ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô"
                    icon={Sparkles}
                />
                <FormInput
                    label="‡πÅ‡∏ô‡∏ß‡πÄ‡∏û‡∏•‡∏á (Genre)"
                    value={genre}
                    onChange={(e) => setGenre(e.target.value)}
                    placeholder={`‡πÄ‡∏ä‡πà‡∏ô: ${popularGenres.join(', ')}`}
                    icon={Music}
                    className="mb-6"
                />
            </div>
            
            <div className="flex justify-end mt-6">
                <AccentButton 
                    onClick={handleGenerateMusic} 
                    disabled={!topic.trim() || !genre.trim() || isLoading}
                    icon={isLoading ? Loader2 : Music}
                    className={isLoading ? "animate-pulse" : ""}
                >
                    {isLoading ? "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á (30s)..." : "‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏û‡∏•‡∏á/‡∏ö‡∏µ‡∏ó‡∏ü‡∏£‡∏µ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ"}
                </AccentButton>
            </div>

            {/* Music Result Display */}
            {musicResult && (
                <div className="mt-8 p-5 bg-blue-50 border border-blue-200 rounded-xl shadow-inner">
                    <h3 className="text-lg font-bold text-blue-800 mb-3 flex items-center gap-2">
                        <Play size={20}/> ‡πÄ‡∏û‡∏•‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß!
                    </h3>
                    <p className="text-sm text-gray-700 mb-4">
                        <span className="font-semibold">{musicResult.title}</span> ({musicResult.duration})
                    </p>
                    
                    {/* ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏û‡∏•‡∏á */}
                    <div className="w-full h-16 bg-blue-300 rounded-lg flex items-center justify-between p-3 mb-4">
                        <p className="font-mono text-xs text-blue-900">Audio Player Placeholder</p>
                        <AccentButton className="!bg-blue-600 hover:!bg-blue-700 !px-3 !py-1.5 !text-sm">
                            ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î MP3
                        </AccentButton>
                    </div>

                    <div className="border-t border-blue-200 pt-3">
                        <p className="text-xs font-semibold text-blue-700">‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡πÄ‡∏û‡∏•‡∏á (Lyrics):</p>
                        <p className="text-xs text-gray-600 mt-1 italic whitespace-pre-wrap">{musicResult.lyrics}</p>
                    </div>
                </div>
            )}
        </div>
    );
};

export default MusicGenerator;